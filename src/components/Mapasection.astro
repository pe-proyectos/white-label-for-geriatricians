---
import Cardclinicas from "./Cardclinicas.astro";
---

<section id="Ubicacion">
    <div class="px-10 md:px-19 py-10">
        <div class="justify-items-center mb-10">
            <h3
                class="text-[1.8rem] md:text-[2.15rem] font-bold text-gray-800 mb-2.5"
            >
                Centros de <span class="text-[#84b6f4]">Consulta</span>
            </h3>
            <div class="border-b-4 w-20 border-[#84b6f4]"></div>
        </div>
        <div class="flex flex-col md:flex-row gap-10">
            <div class="flex flex-col w-full lg:w-1/2">
                <div class="bg-gray-50 rounded-2xl p-6">
                    <div class="mb-6">
                        <h1
                            class="flex gap-3 font-bold items-center text-lg text-gray-800"
                        >
                            <div class="bg-[#84b6f4] p-2 rounded-full">
                                <svg
                                    class="w-5 h-5 text-white"
                                    aria-hidden="true"
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="24"
                                    height="24"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke="currentColor"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                                    ></path>
                                    <path
                                        stroke="currentColor"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M17.8 13.938h-.011a7 7 0 1 0-11.464.144h-.016l.14.171c.1.127.2.251.3.371L12 21l5.13-6.248c.194-.209.374-.429.54-.659l.13-.155Z"
                                    ></path>
                                </svg>
                            </div>
                            Encuentra una ubicación cerca de ti
                        </h1>
                    </div>

                    <div class="space-y-4">
                        <div
                            class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"
                        >
                            <button
                                class="btn-clinica w-full flex items-center justify-between p-4 cursor-pointer font-semibold text-gray-800 hover:bg-gray-50 transition-colors duration-200"
                            >
                                <div class="flex items-center gap-3">
                                    <div class="bg-[#84b6f4]/10 p-2 rounded-lg">
                                        <svg
                                            class="w-4 h-4 text-[#84b6f4]"
                                            fill="currentColor"
                                            viewBox="0 0 20 20"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                                                clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <span>Ciudad de Jaén</span>
                                    <span
                                        class="bg-[#84b6f4] text-white text-xs px-2 py-1 rounded-full"
                                        >13</span
                                    >
                                </div>
                                <svg
                                    class="w-5 h-5 text-gray-400 transform transition-transform duration-200"
                                    aria-hidden="true"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke="currentColor"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="m19 9-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div
                                class="clinicas-list max-h-80 overflow-y-auto border-t border-gray-100
                                    [&::-webkit-scrollbar]:w-2
                                    [&::-webkit-scrollbar-track]:rounded-full
                                    [&::-webkit-scrollbar-track]:bg-gray-50
                                    [&::-webkit-scrollbar-thumb]:rounded-full
                                    [&::-webkit-scrollbar-thumb]:bg-[#84b6f4]/30
                                    [&::-webkit-scrollbar-thumb:hover]:bg-[#84b6f4]/50"
                                style="display: block;"
                            >
                                <Cardclinicas
                                    name="Hospital General de Jaén"
                                    address="Distrito de Jaén, Provincia de Jaén, Departamento de Cajamarca"
                                />
                                <Cardclinicas
                                    name="Clínica de la Solidaridad"
                                    address="Calle Garcilazo de la Vega N° 415 - Jaén"
                                    number="+51 965 065 550"
                                />
                                <Cardclinicas
                                    name="Clínica San Juan"
                                    address="Calle Túpac Amaru N° 695 - Jaén"
                                    number="+51 956 143 256"
                                />
                                <Cardclinicas
                                    name="Centro Médico San Nicolas"
                                    address="Calle Alfredo Bastos N° 246"
                                    number="+51 941 357 857"
                                />
                                <Cardclinicas
                                    name="Clínica Quiruclinic"
                                    address="Calle San Martín N° 1641"
                                    number="+51 926 185 477"
                                />
                                <Cardclinicas
                                    name="Neuromedic Jaén"
                                    address="Calle Ecología N°111 Urb Gran Marañón Altura Puente Pakamuros"
                                    number="+51 978 516 870 / +51 974 688 831"
                                />
                                <Cardclinicas
                                    name="Cadilab"
                                    address="Calle Pardo Miguel N° 270"
                                    number="+51 924 516 612"
                                />
                                <Cardclinicas
                                    name="Cadilab"
                                    address="Av Pakamuros N° 1212"
                                    number="+51 924 516 612"
                                />
                                <Cardclinicas
                                    name="Lab Norberth Winnner Jaén"
                                    address="Calle Los Lirios 170"
                                    number="+51 969 568 243"
                                />
                                <Cardclinicas
                                    name="Clínica Ebenezer"
                                    address="Calle Garcilazo de la Vega N° 407"
                                    number="+51 989 401 537"
                                />
                                <Cardclinicas
                                    name="Clínica Belen"
                                    address="Calle Huamantanga N° 999"
                                    number="+51 915 083 558"
                                />
                                <Cardclinicas
                                    name="Clínica Ángel"
                                    address="Calle Zarumilla 1316"
                                    number="+51 944 464 289 / +51 992 724 621"
                                />
                                <Cardclinicas
                                    name="Clínica Alienta"
                                    address="Prolongación Raymondi N° 103"
                                    number="+51 962 802 139"
                                />
                            </div>
                        </div>
                        <div
                            class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"
                        >
                            <button
                                class="btn-clinica w-full flex items-center justify-between p-4 cursor-pointer font-semibold text-gray-800 hover:bg-gray-50 transition-colors duration-200"
                            >
                                <div class="flex items-center gap-3">
                                    <div class="bg-[#84b6f4]/10 p-2 rounded-lg">
                                        <svg
                                            class="w-4 h-4 text-[#84b6f4]"
                                            fill="currentColor"
                                            viewBox="0 0 20 20"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                                                clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <span>Ciudad de Bagua</span>
                                    <span
                                        class="bg-[#84b6f4] text-white text-xs px-2 py-1 rounded-full"
                                        >5</span
                                    >
                                </div>
                                <svg
                                    class="w-5 h-5 text-gray-400 transform transition-transform duration-200"
                                    aria-hidden="true"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke="currentColor"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="m19 9-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div
                                class="clinicas-list max-h-80 overflow-y-auto border-t border-gray-100
                                    [&::-webkit-scrollbar]:w-2
                                    [&::-webkit-scrollbar-track]:rounded-full
                                    [&::-webkit-scrollbar-track]:bg-gray-50
                                    [&::-webkit-scrollbar-thumb]:rounded-full
                                    [&::-webkit-scrollbar-thumb]:bg-[#84b6f4]/30
                                    [&::-webkit-scrollbar-thumb:hover]:bg-[#84b6f4]/50"
                                style="display: none;"
                            >
                                <Cardclinicas
                                    name="Hospital De Apoyo Bagua Gustavo Lanatta Luján"
                                    address="Distrito de Bagua, Provincia de Bagua, Departamento de Amazonas"
                                />
                                <Cardclinicas
                                    name="Clínica Interamericana"
                                    address="Av. Héroes del Cenepa N1795"
                                    number="+51 992 484 913"
                                />
                                <Cardclinicas
                                    name="Clínica Pediatric Kids y Especialidades"
                                    address="Jr. La Verdad N°628"
                                    number="+51 930 975 694"
                                />
                                <Cardclinicas
                                    name="Clínica Montecarlo"
                                    address="Jr. Comercio N° 576 Bagua"
                                    number="+51 956 542 166"
                                />
                                <Cardclinicas
                                    name="Cadilab"
                                    address="Calle Sargento Lores N°569"
                                    number="+51 931 526 349 "
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-full md:w-2/3 p-0 md:p-0 relative content-center">
                <div
                    id="map"
                    class="w-full h-[20rem] md:h-[30rem] rounded-4xl z-0 shadow-md shadow-gray-300 relative"
                >
                </div>
                <div
                    class="absolute mx-auto top-5 md:top-15 left-1/2 -translate-x-1/2 p"
                >
                    <div
                        class="flex justify-center w-full gap-2 bg-white/90 md:px-4 px-2 md:py-3 py-1 rounded-full"
                    >
                        <div>
                            <button
                                id="reiniciarmapa"
                                class="font-semibold px-5 py-1.5 border-1 rounded-full bg-[#84b6f4] hover:bg-[#67a4f0] text-white w-fit md:w-[7rem] md:text-base text-xs"
                                >Reiniciar</button
                            >
                        </div>
                        <div>
                            <button
                                id="centrarmapa"
                                class="font-semibold px-5 py-1.5 border-1 rounded-full bg-[#84b6f4] hover:bg-[#67a4f0] text-white w-fit md:w-[7rem] md:text-base text-xs"
                            >
                                Ubicarme
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        import { clinicas } from "../utils/clinicas.js";

        const coor_inicial = [-5.684192418798546, -78.66426492419724];
        const zoom_inicial = 10;
        // @ts-ignore
        window.mapita = L.map("map").setView(coor_inicial, zoom_inicial);
        // @ts-ignore
        L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
            minZoom: 6,
            maxZoom: 19,
            attribution:
                '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        }).addTo(window.mapita);
        // @ts-ignore
        L.control.scale().addTo(window.mapita);

        clinicas.map((u) => {
            // @ts-ignore
            let marker = L.marker([u.x, u.y], { draggable: false }).addTo(
                window.mapita,
            );
            marker.bindPopup(u.name);
        });

        let centrar = document.querySelector("#reiniciarmapa");
        centrar?.addEventListener("click", () => {
            window.mapita.setView(coor_inicial, zoom_inicial);
        });

        const botones = document.querySelectorAll(".btn-clinica");

        botones.forEach((button) => {
            button.addEventListener("click", () => {
                let actual = button.nextElementSibling as HTMLElement;
                if (!actual?.style) return;
                if (actual.style.display == "block") {
                    actual.style.display = "none";
                    actual.style.visibility = "hidden";

                    (botones as NodeListOf<HTMLElement>).forEach((b) => {
                        let next = b?.nextElementSibling as HTMLElement;
                        if (b !== button && next?.style) {
                            next.style.display = "block";
                            next.style.visibility = "visible";
                        }
                    });
                } else {
                    actual.style.display = "block";
                    actual.style.visibility = "visible";

                    (botones as NodeListOf<HTMLElement>).forEach((b) => {
                        let next1 = b?.nextElementSibling as HTMLElement;
                        if (b !== button && next1?.style) {
                            next1.style.display = "none";
                            next1.style.visibility = "hidden";
                        }
                    });
                }
            });
        });

        document.querySelector("#centrarmapa")?.addEventListener("click", () =>
            navigator.geolocation.getCurrentPosition((p) => {
                const ubi_user = [p.coords.latitude, p.coords.longitude];
                // @ts-ignore
                L.marker(ubi_user)
                    .addTo(window.mapita)
                    .bindPopup("📍 Estás aquí")
                    .openPopup();

                window.mapita.fitBounds([ubi_user, coor_inicial]);
            }),
        );
    </script>
</section>
